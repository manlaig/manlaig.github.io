<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f336c52a2ccc6e110cf7.css">html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;background:#f0f0f0;vertical-align:middle}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:1.75rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.5rem}h3{font-size:1.35rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,p{padding:0;margin:0 0 1.45rem}p{font-family:Georgia,Times New Roman,Times,serif;font-size:20px;font-weight:500}figure{padding:0}figure,pre{margin:0 0 1.45rem}pre{font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.nav{position:fixed;width:100%}.name{font-size:28px;letter-spacing:.5px;font-weight:500}#card-blog{width:auto;display:flex;margin-bottom:25px}#card-blog,#card-projects{-webkit-transition:all .3s cubic-bezier(.25,.8,.25,1);transition:all .3s cubic-bezier(.25,.8,.25,1)}#card-blog:hover,#card-projects:hover{box-shadow:0 7px 16px rgba(0,0,0,.2),0 6px 7px rgba(0,0,0,.2)}#quote{margin-bottom:25px;font-size:18px;text-align:center}</style><meta name="generator" content="Gatsby 2.13.41"/><title data-react-helmet="true">Dynamic grid-based object placement</title><link as="script" rel="preload" href="/1-ce833077846c4ec3bee0.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-73a90add7706e3337cf6.js"/><link as="script" rel="preload" href="/app-b417cef637867fbad829.js"/><link as="script" rel="preload" href="/styles-cf0d263f3c352d5b53bb.js"/><link as="script" rel="preload" href="/webpack-runtime-3640506a88af04e5e73e.js"/><link as="fetch" rel="preload" href="/page-data/building-placement/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="jss1" class="nav"><header class="jss15 jss21 jss6 jss7 jss13 mui-fixed" style="background:#363640"><div class="jss42 jss44 jss43"><a title="Go to Home" style="text-decoration:none;color:#FFF" href="/"><div class="name">Michael Ganzorig</div></a><div class="jss2"></div><div class="jss4"><a style="font-size:22px;text-decoration:none;color:rgba(255,255,255,0.75);margin-right:20px" href="/about">About</a><a style="font-size:22px;text-decoration:none;color:rgba(255,255,255,0.75);margin-right:20px" href="/projects">Projects</a><a style="font-size:22px;text-decoration:none;color:rgba(255,255,255,0.75);margin-right:20px" href="/blog">Writing</a></div><div class="jss5"><button class="jss52 jss46 jss47" tabindex="0" type="button"><span class="jss51"><a style="color:rgba(255,255,255,1)" href="/"><svg class="jss55" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg></a></span></button><button class="jss52 jss46 jss47" tabindex="0" type="button" aria-haspopup="true"><span class="jss51"><svg class="jss55" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path fill="none" d="M0 0h24v24H0z"></path><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></span></button></div></div></header></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:100px"><div><div><h1>Dynamic grid-based object placement</h1><div style="letter-spacing:0.2px"><h2>End Result</h2>
<img src="/static/images/object_placement.gif">
<h2>Intro</h2>
<p>In Unity, placing object while checking collisions can done simply with a raycast, but RTS games have a grid under the object which shows whether it can be placed at that spot or not.</p>
<img src="/static/images/example-building-place.jpg" width="400px" height="300px">
<p>The <em><a href="https://imgur.com/OmFT6">image</a></em> above shows Starcraft’s object placement grid.</p>
<p><strong>This grid needs to be resized based on the object being placed and it must change colors depending on what’s underneath it.</strong> One solution is to get the area of the object and fill it with grid tiles. And that's what we'll do for this implementation.</p>
<h2>Implementation</h2>
<h3>Placing objects with a raycast</h3>
<p>It’s always a good idea to start simple and gradually build up. So, how to place something on a plane?</p>
<p>To simply place something on a plane can be done with a single function call.</p>
<pre><code class="language-csharp">[SerializeField] LayerMask layerToRaycast;
[SerializeField] GameObject object;

void RaycastToMouse()
{
    Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
    RaycastHit hit;
    if (Physics.Raycast(ray, out hit, Mathf.Infinity, layerToRaycast))
        object.transform.position = hit.point;
}
</code></pre>
<p>Raycasting this way sends a ray that collides with specific layers that we set in the inspector, which will be very useful in our case. With the above code, we need our plane to be in a specific layer and set <code>layerToRaycast</code> to that layer in the inspector.</p>
<p>Now, an object can be placed on a plane, but it can be placed on top of other objects. Obviously, this is an issue. There are some solutions to this problem. For this writing, I chose to use <em>layers</em>. This is so that objects, that cannot be placed on top of, can be in the same layer. Using layers is the easiest solution because we wouldn't need any more scripts, we just need to place certain GameObjects in certain layers.</p>
<h3>BuildingSO (ScriptableObject)</h3>
<p>I think, having a <code>ScriptableObject</code> for each placeable object is a good way to do it. This <code>ScriptableObject</code> will define everything about the placeable object and the same asset can be later used in multiple cases. For example, if we want to display it in an inventory.</p>
<p>I think of ScriptableObjects being like <code>struct</code>s. The cool thing about them is that they <strong>can be stored as assets.</strong> I found <a href="https://youtu.be/raQ3iHhE_Kk">this</a> talk about game architectures using ScriptableObjects to be very interesting.</p>
<p>For this implementation, placeable objects are represented as <code>BuildingSO</code>s that contains their name, prefab, build time, cost, and icon.</p>
<pre><code class="language-csharp">[CreateAssetMenu(menuName = "Placeable/Object")]
public class BuildingSO : ScriptableObject
{
    public string name;
    public GameObject buildingPrefab;
    public float buildTime;
    public float cost;
    public Icon icon;
}
</code></pre>
<p>By putting an attribute <code>CreateAssetMenu</code> on top, creating an asset of <code>BuildingSO</code> can be done just like any other Asset!</p>
<p>I hope at this point, it is clear why ScriptableObjects are useful in this case (we have everything we need to know about the object in one asset!).</p>
<h3>Grid Tiles</h3>
<p>So far, objects can be placed on a plane. Actually, it can be placed on anything, I am just using planes for the simplicity. Also, we have a ScriptableObject for the objects that will be placed.</p>
<p>The problem to solve now is detecting collisions, so that objects cannot be placed on top of some other objects. Remember, the above function for raycasting accepts a layer, which means we can send rays to specific layers. We will use that for the collision grid.</p>
<p>The grid consists of <em>tiles</em>. Each tile is a <strong>quad that turns green is no collision or red if there’s a collision</strong>.</p>
<p>One way to do it, we can attach a script to each tile and implements its <code>OnTriggerEnter</code> and <code>OnTriggerExit</code> functions and detect whether the collider lies in the collision layer.</p>
<pre><code class="language-csharp">[SerializeField] LayerMask collisionLayers;
public bool colliding { get; private set; } 

void OnTriggerEnter(Collider other)
{
    if(collisionLayers == (collisionLayers | (1 &#x3C;&#x3C; other.gameObject.layer)))
    {
        if(other.gameObject.transform.root.gameObject.GetInstanceID() != transform.root.gameObject.GetInstanceID())
        {
            SetColor(Color.red);
            colliding = true;
        }
    }
}

void OnTriggerExit(Collider other)
{
    if(collisionLayers == (collisionLayers | (1 &#x3C;&#x3C; other.gameObject.layer)))
    {
        SetColor(Color.green);
        colliding = false;
    }
}
</code></pre>
<p>After assigning <code>collisionLayers</code> in the inspector, the grid tile will change colors if it collides with an object in <code>collisionLayers</code>.</p>
<h3>Dynamically resizing grids</h3>
<p>Now that grid tiles are complete, we need to find a way to <strong>make a grid depending on the size of the placing object</strong>.</p>
<p>So, let's simplify the problem. We need to somehow <strong>find the area of the GameObject and fill it with grid tiles</strong>. Since we don't want our placeable objects to be built on top of other placeable objects, we send a ray to check. Furthermore, this means each placeable object must have a collider attached to it. Otherwise, raycasts will not work.</p>
<p>The <code>Collider</code> class has a property called <code>bounds</code> and <code>bounds.extents</code>. We can use these properties to get the area of the collider.</p>
<pre><code class="language-csharp">[SerializeField] GameObject tileGO;
GameObject grid;

Rect MakeRectOfCollider(Collider col)
{
    Rect r = new Rect(col.bounds.center.x - col.bounds.extents.x,
                    col.bounds.center.z - col.bounds.extents.z,
                    col.bounds.size.x, col.bounds.size.z);
    return r;
}

void FillRectWithTiles(Collider col)
{
    if(grid)
        return;

    Rect rect = MakeRectOfCollider(col);
    float fromX = rect.position.x;
    float toX = rect.position.x + rect.width;
    float fromZ = rect.position.y;
    float toZ = rect.position.y + rect.height;

    GameObject parent = new GameObject("Grid");
    parent.transform.SetParent(col.gameObject.transform.root);
    parent.transform.position = col.gameObject.transform.position;

    for(float i = fromX; i &#x3C; toX; i += tileGO.transform.localScale.x)
        for(float j = fromZ; j &#x3C; toZ; j += tileGO.transform.localScale.y)
        {
            GameObject tile = Instantiate(tileGO);
            tile.transform.SetParent(parent.transform);
            tile.transform.position = new Vector3(i, parent.transform.position.y + 1, j);
            activeTiles.Add(tile.GetComponent&#x3C;GridTile>());
        }
    grid = parent;
}
</code></pre>
<p>The <code>FillRectWithTiles</code> loops through the rectangle representing the area of the object and spawns grid tiles along the way.</p>
<h2>End Result</h2>
<p>The finished project can be found <a href="https://github.com/manlaig/object_placement">here</a></p>
<img src="/static/images/desert.gif" width="400px" height="400px">
<img src="https://i.imgflip.com/2prua5.gif"/></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/building-placement";window.webpackCompilationHash="3f30949cf3726ef60912";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-b417cef637867fbad829.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-73a90add7706e3337cf6.js"],"component---src-pages-404-js":["/component---src-pages-404-js-80d1e886553dc53696db.js"],"component---src-pages-about-js":["/component---src-pages-about-js-4b45ef25b3e57c284e07.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-c6470f96658ad799afc8.js"],"component---src-pages-index-js":["/component---src-pages-index-js-557571b87a513a8bf8d7.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-c365e45841ecc14e887d.js"]};/*]]>*/</script><script src="/webpack-runtime-3640506a88af04e5e73e.js" async=""></script><script src="/styles-cf0d263f3c352d5b53bb.js" async=""></script><script src="/app-b417cef637867fbad829.js" async=""></script><script src="/component---src-templates-blog-post-js-73a90add7706e3337cf6.js" async=""></script><script src="/1-ce833077846c4ec3bee0.js" async=""></script></body></html>